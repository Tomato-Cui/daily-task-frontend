"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),t={__name:"list",setup(t){const r=e.ref(""),l=e.ref("worker"),s=["全部","最新","热门","推荐"],o=["全部","招募中","进行中","已完成"],n=e.ref(0),u=e.ref([]),i=e.ref(!1),d=e.ref(1),v=e.ref(10);e.watch(l,(()=>{u.value=[],d.value=1,c()}));const c=async()=>{i.value=!0;try{const a=await e.index.request({url:"http://localhost:3000/tasks",method:"GET",data:{page:d.value,pageSize:v.value,role:l.value,tab:n.value,searchKey:r.value}});if(200===a.statusCode){const e=a.data.map((e=>({...e,publisher:e.publisher||{id:0,name:"未知用户",avatar:"/static/default-avatar.png"}})));u.value=1===d.value?e:[...u.value,...e]}else e.index.showToast({title:"获取任务列表失败",icon:"none"})}catch(a){console.error("获取任务列表失败:",a),e.index.showToast({title:"网络请求失败",icon:"none"})}finally{i.value=!1}},p=()=>{i.value||(d.value++,c())},g=e=>{const a=new Date(e);return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`},h=e=>{switch(e){case"open":return"status-open";case"in_progress":return"status-progress";case"completed":default:return"status-completed";case"closed":return"status-closed"}},m=e=>{switch(e){case"open":return"招募中";case"in_progress":return"进行中";case"completed":return"已完成";case"closed":return"已关闭";default:return"未知"}};return e.onLoad((()=>{const a=e.index.getStorageSync("userRole");a&&(l.value=a),c()})),(t,d)=>e.e({a:e.t("employer"===l.value?"我发布的任务":"找任务"),b:"employer"===l.value},"employer"===l.value?{c:e.o((a=>{return t="/pages/tasks/create/create",void e.index.navigateTo({url:t});var t}))}:{},{d:r.value,e:e.o((e=>r.value=e.detail.value)),f:e.f("employer"===l.value?o:s,((a,t,r)=>({a:e.t(a),b:t,c:n.value===t?1:"",d:e.o((e=>n.value=t),t)}))),g:0===u.value.length},0===u.value.length?{h:a._imports_0$1}:{i:e.f(u.value,((a,t,r)=>{var s,o;return e.e({a:e.t(a.title),b:e.t(m(a.status)),c:e.n(h(a.status)),d:e.t(a.description),e:e.t(a.reward),f:e.t(g(a.deadline)),g:(null==(s=a.publisher)?void 0:s.avatar)||"/static/default-avatar.png",h:e.t((null==(o=a.publisher)?void 0:o.name)||"未知用户"),i:e.o((t=>{return r=a.id,void e.index.navigateTo({url:`/pages/tasks/detail/detail?id=${r}`,animationType:"fade-in",animationDuration:200});var r}),a.id)},"worker"===l.value?{j:e.o((t=>{return r=a.id,t.stopPropagation(),void e.index.navigateTo({url:`/pages/tasks/detail/detail?id=${r}`});var r}),a.id)}:{k:e.o((t=>{return r=a.id,t.stopPropagation(),void e.index.navigateTo({url:`/pages/tasks/detail/detail?id=${r}&manage=true`});var r}),a.id)},{l:a.id})})),j:"worker"===l.value},{k:i.value&&u.value.length>0},(i.value&&u.value.length,{}),{l:e.o(p)})}};wx.createPage(t);

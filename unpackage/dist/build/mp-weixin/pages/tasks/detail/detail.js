"use strict";const t=require("../../../common/vendor.js"),e={data:()=>({isLoading:!0,task:{id:0,title:"",description:"",reward:0,publishTime:new Date,deadline:new Date,location:"",requiredPeople:0,contactPerson:"",contactPhone:"",status:"open",requirements:[],publisher:{id:0,name:"",avatar:""},applicants:[]},userRole:"worker",isApplied:!1,isEmployer:!1,taskId:0}),onLoad(e){e.id&&(this.taskId=e.id,t.index.showLoading({title:"加载中..."}),this.fetchTaskDetail());const s=t.index.getStorageSync("userRole");s&&(this.userRole=s)},methods:{fetchTaskDetail(){setTimeout((()=>{this.task={id:this.taskId,title:"设计一个企业Logo",description:"需要设计一个现代化的企业Logo，要求简洁、大方，能够展现企业的专业形象。需要提供源文件和至少3种不同颜色方案。我们是一家科技公司，希望Logo能够体现创新和科技感。",reward:500,publishTime:new Date("2023-12-01"),deadline:new Date("2023-12-30"),location:"远程工作",requiredPeople:1,contactPerson:"张经理",contactPhone:"13800138000",status:"open",requirements:["有平面设计经验","熟练掌握PS、AI等设计软件","有良好的沟通能力","能够按时完成任务"],publisher:{id:1,name:"张企业",avatar:"http://iph.href.lu/50x50"},applicants:[{id:101,name:"李设计",avatar:"http://iph.href.lu/50x50",applyTime:new Date("2023-12-05"),status:""},{id:102,name:"王绘画",avatar:"http://iph.href.lu/50x50",applyTime:new Date("2023-12-06"),status:""}]};const e=t.index.getStorageSync("userInfo");e&&e.id===this.task.publisher.id&&(this.isEmployer=!0),this.isApplied=Math.random()>.5,t.index.hideLoading(),this.isLoading=!1}),500)},goBack(){t.index.navigateBack({animationType:"fade-out",animationDuration:200})},applyTask(){t.index.navigateTo({url:`/pages/applications/apply/apply?id=${this.task.id}`})},cancelApply(){t.index.showModal({title:"确认取消",content:"确认取消申请此任务吗？",success:e=>{e.confirm&&(t.index.showLoading({title:"取消中..."}),setTimeout((()=>{t.index.hideLoading(),this.isApplied=!1,t.index.showToast({title:"已取消申请"})}),1e3))}})},contactEmployer(){t.index.makePhoneCall({phoneNumber:this.task.contactPhone,fail:()=>{t.index.showToast({title:"拨打电话失败",icon:"none"})}})},completeTask(){t.index.showModal({title:"确认完成",content:"确认该任务已完成吗？",success:e=>{e.confirm&&(t.index.showLoading({title:"提交中..."}),setTimeout((()=>{t.index.hideLoading(),this.task.status="completed",t.index.showToast({title:"已标记为完成"})}),1e3))}})},editTask(){t.index.navigateTo({url:`/pages/tasks/edit/edit?id=${this.task.id}`})},closeTask(){t.index.showModal({title:"确认关闭",content:"确认关闭此任务吗？关闭后将不再接受新的申请。",success:e=>{e.confirm&&(t.index.showLoading({title:"提交中..."}),setTimeout((()=>{t.index.hideLoading(),this.task.status="closed",t.index.showToast({title:"已关闭任务"})}),1e3))}})},acceptApplicant(e){t.index.showModal({title:"确认接受",content:"确认接受此申请者吗？",success:s=>{s.confirm&&(t.index.showLoading({title:"处理中..."}),setTimeout((()=>{t.index.hideLoading(),this.task.applicants.forEach((t=>{t.id===e&&(t.status="accepted")})),this.task.status="in_progress",t.index.showToast({title:"已接受申请"})}),1e3))}})},rejectApplicant(e){t.index.showModal({title:"确认拒绝",content:"确认拒绝此申请者吗？",success:s=>{s.confirm&&(t.index.showLoading({title:"处理中..."}),setTimeout((()=>{t.index.hideLoading(),this.task.applicants.forEach((t=>{t.id===e&&(t.status="rejected")})),t.index.showToast({title:"已拒绝申请"})}),1e3))}})},getStatusClass(t){switch(t){case"open":return"status-open";case"in_progress":return"status-progress";case"completed":default:return"status-completed";case"closed":return"status-closed"}},getStatusText(t){switch(t){case"open":return"招募中";case"in_progress":return"进行中";case"completed":return"已完成";case"closed":return"已关闭";default:return"未知"}},formatDate(t){const e=new Date(t);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`},viewApplications(){t.index.switchTab({url:"/pages/applications/status/status"})}}};const s=t._export_sfc(e,[["render",function(e,s,a,i,o,n){return t.e({a:t.o(((...t)=>n.goBack&&n.goBack(...t))),b:o.isLoading},o.isLoading?{}:t.e({c:t.t(o.task.title),d:t.t(n.getStatusText(o.task.status)),e:t.n(n.getStatusClass(o.task.status)),f:o.task.publisher.avatar,g:t.t(o.task.publisher.name),h:t.t(n.formatDate(o.task.publishTime)),i:t.t(o.task.reward),j:t.t(n.formatDate(o.task.deadline)),k:t.t(o.task.location),l:t.t(o.task.requiredPeople),m:t.t(o.task.description),n:t.f(o.task.requirements,((e,s,a)=>({a:t.t(e),b:s}))),o:o.isApplied||o.isEmployer},o.isApplied||o.isEmployer?{p:t.t(o.task.contactPerson),q:t.t(o.task.contactPhone)}:{},{r:o.isEmployer&&o.task.applicants&&o.task.applicants.length>0},o.isEmployer&&o.task.applicants&&o.task.applicants.length>0?{s:t.t(o.task.applicants.length),t:t.f(o.task.applicants,((e,s,a)=>t.e({a:e.avatar,b:t.t(e.name),c:t.t(n.formatDate(e.applyTime))},"open"===o.task.status?{d:t.o((t=>n.acceptApplicant(e.id)),s),e:t.o((t=>n.rejectApplicant(e.id)),s)}:e.status?{g:t.t("accepted"===e.status?"已接受":"已拒绝")}:{},{f:e.status,h:s}))),v:"open"===o.task.status}:{},{w:"worker"===o.userRole},"worker"===o.userRole?t.e({x:!o.isApplied&&"open"===o.task.status},o.isApplied||"open"!==o.task.status?(o.isApplied&&o.task.status,{}):{y:t.o(((...t)=>n.applyTask&&n.applyTask(...t)))},{z:o.isApplied&&"open"===o.task.status,A:o.isApplied&&"open"===o.task.status},o.isApplied&&"open"===o.task.status?{B:t.o(((...t)=>n.cancelApply&&n.cancelApply(...t)))}:{},{C:o.isApplied&&"in_progress"===o.task.status},o.isApplied&&"in_progress"===o.task.status?{D:t.o(((...t)=>n.contactEmployer&&n.contactEmployer(...t)))}:{},{E:o.isApplied&&"in_progress"===o.task.status},o.isApplied&&"in_progress"===o.task.status?{F:t.o(((...t)=>n.completeTask&&n.completeTask(...t)))}:{}):"employer"===o.userRole&&o.isEmployer?t.e({H:o.task.applicants&&o.task.applicants.length>0},o.task.applicants&&o.task.applicants.length>0?{I:t.t(o.task.applicants.length),J:t.o(((...t)=>n.viewApplications&&n.viewApplications(...t)))}:{},{K:"open"===o.task.status},"open"===o.task.status?{L:t.o(((...t)=>n.editTask&&n.editTask(...t)))}:{},{M:"open"===o.task.status},"open"===o.task.status?{N:t.o(((...t)=>n.closeTask&&n.closeTask(...t)))}:{},{O:"in_progress"===o.task.status},"in_progress"===o.task.status?{P:t.o(((...t)=>n.completeTask&&n.completeTask(...t)))}:{}):{},{G:"employer"===o.userRole&&o.isEmployer}))}]]);wx.createPage(s);

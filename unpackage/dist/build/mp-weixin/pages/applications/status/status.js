"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),a={data:()=>({userRole:"worker",workerTabs:["全部","待审核","已接受","已拒绝"],employerTabs:["全部","待处理","已接受","已拒绝"],currentTab:0,applications:[],myTasks:[],loading:!1,pageNum:1,pageSize:10}),onLoad(){const t=e.index.getStorageSync("userRole");t&&(this.userRole=t),this.fetchApplications()},onShow(){this.pageNum=1,this.applications=[],this.myTasks=[],this.fetchApplications()},methods:{fetchApplications(){this.loading=!0,setTimeout((()=>{"worker"===this.userRole?this.applications=[{id:1001,task:{id:1,title:"设计一个企业Logo",publisher:{id:101,name:"张企业",phone:"13800138000"}},applyTime:new Date("2023-12-05"),expectedReward:500,status:"pending"},{id:1002,task:{id:2,title:"开发一个小程序页面",publisher:{id:102,name:"李科技",phone:"13900139000"}},applyTime:new Date("2023-12-02"),expectedReward:800,status:"accepted"},{id:1003,task:{id:3,title:"撰写产品介绍文案",publisher:{id:103,name:"王营销",phone:"13700137000"}},applyTime:new Date("2023-11-28"),expectedReward:300,status:"rejected"}]:this.myTasks=[{id:101,title:"招聘临时搬运工",reward:400,status:"open",expanded:!0,applicants:[{id:201,name:"李搬运",avatar:"http://iph.href.lu/50x50",phone:"138****5678",introduction:"有多年搬运经验，力气大，速度快。",expectedReward:400,additionalInfo:"可带助手一起完成工作",applyTime:new Date("2023-12-05"),status:"pending"},{id:202,name:"王力工",avatar:"http://iph.href.lu/50x50",phone:"139****1234",introduction:"专业搬家公司员工，有丰富经验。",expectedReward:450,additionalInfo:"",applyTime:new Date("2023-12-06"),status:"pending"}]},{id:102,title:"活动现场发传单",reward:300,status:"in_progress",expanded:!1,applicants:[{id:203,name:"张宣传",avatar:"http://iph.href.lu/50x50",phone:"136****2345",introduction:"曾参与多个促销活动，经验丰富。",expectedReward:300,additionalInfo:"",applyTime:new Date("2023-12-01"),status:"accepted"},{id:204,name:"刘活动",avatar:"http://iph.href.lu/50x50",phone:"135****6789",introduction:"大学生，寻找兼职工作，有责任心。",expectedReward:280,additionalInfo:"可以全天工作",applyTime:new Date("2023-12-02"),status:"rejected"}]}],this.loading=!1}),500)},loadMore(){this.loading||(this.pageNum++,this.fetchApplications())},viewApplicationDetail(t){const a=this.applications.find((e=>e.id===t));a&&e.index.navigateTo({url:`/pages/tasks/detail/detail?id=${a.task.id}`})},cancelApplication(t){e.index.showModal({title:"确认取消",content:"确认取消此申请吗？",success:a=>{a.confirm&&(e.index.showLoading({title:"取消中..."}),setTimeout((()=>{e.index.hideLoading();const a=this.applications.findIndex((e=>e.id===t));-1!==a&&this.applications.splice(a,1),e.index.showToast({title:"已取消申请",icon:"success"})}),500))}})},contactEmployer(t){t?e.index.makePhoneCall({phoneNumber:t,fail:()=>{e.index.showToast({title:"拨打电话失败",icon:"none"})}}):e.index.showToast({title:"联系电话不存在",icon:"none"})},toggleApplicationList(e){this.myTasks[e].expanded=!this.myTasks[e].expanded},acceptApplicant(t,a){e.index.showModal({title:"确认接受",content:"确认接受此申请者吗？接受后任务将进入进行中状态，其他申请者将自动被拒绝。",success:s=>{s.confirm&&(e.index.showLoading({title:"处理中..."}),setTimeout((()=>{e.index.hideLoading();const s=this.myTasks.findIndex((e=>e.id===t));-1!==s&&(this.myTasks[s].applicants.forEach((e=>{e.id===a?e.status="accepted":e.status="rejected"})),this.myTasks[s].status="in_progress"),e.index.showToast({title:"已接受申请",icon:"success"})}),500))}})},rejectApplicant(t,a){e.index.showModal({title:"确认拒绝",content:"确认拒绝此申请者吗？",success:s=>{s.confirm&&(e.index.showLoading({title:"处理中..."}),setTimeout((()=>{e.index.hideLoading();const s=this.myTasks.findIndex((e=>e.id===t));if(-1!==s){const e=this.myTasks[s].applicants.findIndex((e=>e.id===a));-1!==e&&(this.myTasks[s].applicants[e].status="rejected")}e.index.showToast({title:"已拒绝申请",icon:"success"})}),500))}})},getStatusClass(e){switch(e){case"pending":default:return"status-pending";case"accepted":return"status-accepted";case"rejected":return"status-rejected";case"open":return"status-open";case"in_progress":return"status-progress";case"completed":return"status-completed";case"closed":return"status-closed"}},getStatusText(e){switch(e){case"pending":return"待审核";case"accepted":return"已接受";case"rejected":return"已拒绝";case"open":return"招募中";case"in_progress":return"进行中";case"completed":return"已完成";case"closed":return"已关闭";default:return"未知"}},formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}}};const s=e._export_sfc(a,[["render",function(a,s,i,n,o,d){return e.e({a:e.t("employer"===o.userRole?"申请管理":"我的申请"),b:e.f("employer"===o.userRole?o.employerTabs:o.workerTabs,((t,a,s)=>({a:e.t(t),b:a,c:o.currentTab===a?1:"",d:e.o((e=>o.currentTab=a),a)}))),c:0===o.applications.length},0===o.applications.length?{d:t._imports_0$1,e:e.t("employer"===o.userRole?"暂无申请记录":"暂无申请")}:"worker"===o.userRole?{g:e.f(o.applications,((t,a,s)=>e.e({a:e.t(t.task.title),b:e.t(d.getStatusText(t.status)),c:e.n(d.getStatusClass(t.status)),d:e.t(d.formatDate(t.applyTime)),e:e.t(t.expectedReward),f:e.t(t.task.publisher.name),g:e.t(d.formatDate(t.applyTime)),h:"pending"===t.status},"pending"===t.status?{i:e.o((e=>d.cancelApplication(t.id)),a)}:{},{j:"accepted"===t.status},"accepted"===t.status?{k:e.o((e=>d.contactEmployer(t.task.publisher.phone)),a)}:{},{l:a,m:e.o((e=>d.viewApplicationDetail(t.id)),a)})))}:"employer"===o.userRole?{i:e.f(o.myTasks,((t,a,s)=>e.e({a:e.t(t.title),b:e.t(d.getStatusText(t.status)),c:e.n(d.getStatusClass(t.status)),d:e.t(t.reward),e:e.t(t.applicants.length),f:e.t(t.expanded?"↑":"↓"),g:e.o((e=>d.toggleApplicationList(a)),a),h:t.expanded},t.expanded?{i:e.f(t.applicants,((a,s,i)=>e.e({a:a.avatar,b:e.t(a.name),c:e.t(d.formatDate(a.applyTime)),d:"pending"!==a.status},"pending"!==a.status?{e:e.t("accepted"===a.status?"已接受":"已拒绝")}:{},{f:e.t(a.phone),g:e.t(a.introduction),h:e.t(a.expectedReward),i:a.additionalInfo},a.additionalInfo?{j:e.t(a.additionalInfo)}:{},{k:"open"===t.status&&"pending"===a.status},"open"===t.status&&"pending"===a.status?{l:e.o((e=>d.acceptApplicant(t.id,a.id)),s),m:e.o((e=>d.rejectApplicant(t.id,a.id)),s)}:{},{n:s})))}:{},{j:a})))}:{},{f:"worker"===o.userRole,h:"employer"===o.userRole,j:o.loading&&o.applications.length>0},(o.loading&&o.applications.length,{}),{k:e.o(((...e)=>d.loadMore&&d.loadMore(...e)))})}]]);wx.createPage(s);
